<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>View Applicants - {{ opportunity.title }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
      body {
        background-color: #f8f9fc;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      }

      .header-box {
        background-color: #e8f0ff;
        border-radius: 10px;
        padding: 15px 20px;
        margin-bottom: 20px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
      }

      .header-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 10px;
      }

      .header-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: #1d4ed8;
      }

      .header-subtitle {
        font-size: 0.95rem;
        color: #555;
      }

      .logo {
        height: 55px;
        width: auto;
      }

      .search-input {
        max-width: 300px;
      }

      .opportunity-card {
        background: white;
        border: 1px solid #dce3f0;
        border-radius: 10px;
        padding: 10px 15px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
      }

      .opportunity-content {
        display: flex;
        align-items: flex-start;
        gap: 10px;
      }

      .opportunity-card img {
        width: 95px;
        height: 95px;
        object-fit: cover;
        border-radius: 6px;
        border: 1px solid #ccc;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        flex-shrink: 0;
      }

      .card-title-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        margin-bottom: 2px;
      }

      .card-title {
        font-weight: 600;
        font-size: 1rem;
        margin-bottom: 3px;
      }

      .tag-box-inline {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        flex-wrap: wrap;
      }

      .badge-tag {
        font-size: 0.8rem;
        padding: 3px 6px;
        border-radius: 4px;
        color: white;
      }

      .small-text {
        font-size: 0.85rem;
        color: #555;
        margin-bottom: 2px;
      }

      .table {
        background: white;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
      }

      .table thead {
        background-color: #dbeafe;
        font-weight: 600;
      }

      .table tbody tr:nth-child(even) {
        background-color: #f9fafb;
      }

      .btn-sm {
        font-size: 0.8rem;
        padding: 3px 7px;
      }

      .no-data {
        text-align: center;
        color: #777;
        margin-top: 20px;
      }
    </style>
  </head>

  <body class="p-4">
    <div class="container">

      <!-- Blue Header -->
      <div class="header-box shadow-sm">
        <div class="header-bar">
          <div class="d-flex align-items-center gap-3">
            <img src="{{ url_for('static', filename='kras_logo.png') }}" alt="KRAS Kickers Logo" class="logo">
            <div>
              <div class="header-title">View Applicants</div>
              <div class="header-subtitle">See volunteers who applied for this opportunity</div>
            </div>
          </div>

          <!-- CHANGED LINE: use back_to_menu_url -->
          <a href="{{ back_to_menu_url }}" class="btn btn-outline-primary btn-sm">Back</a>

        </div>
      </div>

      <!-- Opportunity Card -->
      <div class="opportunity-card mb-4">
        <div class="opportunity-content">
          {% if opportunity.image %}
          <img src="{{ url_for('static', filename=opportunity.image) }}" alt="{{ opportunity.title }}">
          {% endif %}
          <div class="flex-grow-1">
            <div class="card-title-row">
              <div class="card-title mb-0">{{ opportunity.title }}</div>
              <div class="tag-box-inline">

                <!-- CHANGED: tags are plain strings -->
                {% if opportunity.tags %}
                  {% for tag in opportunity.tags %}
                    <span class="badge-tag" style="background-color: #2563eb">{{ tag }}</span>
                  {% endfor %}
                {% endif %}

              </div>
            </div>

            <div class="small-text"><b>Time:</b> {{ opportunity.time }}</div>
            <div class="small-text"><b>Duration:</b> {{ opportunity.duration }}</div>
            <div class="small-text"><b>Mode:</b> {{ opportunity.mode }}</div>
            <div class="small-text"><b>Location:</b> {{ opportunity.location }}</div>
            {% if opportunity.requirements %}
              <div class="small-text"><b>Requirements:</b> {{ opportunity.requirements }}</div>
            {% endif %}
            {% if opportunity.desc %}
              <div class="small-text"><b>Description:</b> {{ opportunity.desc }}</div>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Applicants Table Block -->
      <div class="opportunity-card">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="fw-bold mb-0">Volunteer Applicants</h5>
          <input id="searchInput" type="text" class="form-control form-control-sm search-input" placeholder="Search by name or email">
        </div>

        {% if applicants %}
        <table class="table table-striped table-bordered align-middle mb-0">
          <thead>
            <tr>
              <th>Date Submitted</th>
              <th>Name</th>
              <th>Email</th>
              <th>Status</th>
              <th>View</th>
            </tr>
          </thead>
          <tbody id="applicantsTable">
            {% for a in applicants %}
            <tr>
              <td>{{ a.timestamp }}</td>
              <td>{{ a.first_name }} {{ a.last_name }}</td>   
              <td>{{ a.email }}</td>
              <td>{{ a.status }}</td>
              <td>
              <a href="{{ url_for('review_applicant', app_id=a.id) }}">
                class="btn btn-outline-primary btn-sm">
                Open
              </a>
            </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% else %}
          <p class="text-muted mb-0">No applicants yet for this opportunity.</p>
        {% endif %}
      </div>

    </div>

    <script>
      const searchInput = document.getElementById('searchInput');
      const tableRows = document.querySelectorAll('#applicantsTable tr');

      searchInput.addEventListener('keyup', function() {
        const term = this.value.toLowerCase();
        tableRows.forEach(row => {
          const text = row.textContent.toLowerCase();
          row.style.display = text.includes(term) ? '' : 'none';
        });
      });
    </script>
  </body>
</html>
